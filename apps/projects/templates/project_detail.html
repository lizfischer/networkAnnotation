{% extends "base.html" %}
{% block head %}{% endblock %}

{% block title %} {{ project.title | default:"Project Details" }}{% endblock %}

{% block body %}
    <div class="flex justify-between items-center align-top mb-4">

        <div id="project-details">
            <h1>{{ project.title }}</h1>
            <p class="mb-4">{{ project.description }}</p>
        </div>
        <div class="dropdown dropdown-end">
            <div tabindex="0" role="button" id="project-menu" class="btn m-1"><i class="fa-solid fa-ellipsis-vertical"></i></div>

            <ul tabindex="-1" class="dropdown-content menu bg-base-100 rounded-box z-1 w-52 p-2 shadow-sm">
                <li><a
                        hx-get="{% url 'projects:edit' project.pk %}"
                        hx-target="#project-details"
                        hx-swap="outerHTML"
                        class="">
                    Edit Details
                </a></li>
                <li><a
                        hx-get="{% url 'projects:delete' pk=project.id %}"
                        hx-target="#modal-content"
                        hx-swap="innerHTML"
                        class=""
                        onclick="openModal('Delete Project')">
                    Delete Project
                </a></li>
            </ul>
        </div>

    </div>

    {# ---- DOCUMENTS ---- #}
    <div class="mb-8">
        <div class="flex justify-between items-center mb-2">
            <h2>Documents</h2>
            <a href="{% url 'library:document_create' project_id=project.id %}"
               class="btn btn-primary btn-sm">
                + New Document
            </a>
        </div>

        {% with documents=project.documents.all %}
            {% if documents %}
                <div class="space-y-2">
                    {% for doc in documents %}
                        <div class="border rounded p-4 flex justify-between items-center">
                            <div>
                                <a href="{% url 'library:document_detail' project_id=project.id document_id=doc.id %}"
                                   class="link font-semibold">
                                    {{ doc.title }}
                                </a>
                                {% if doc.description %}
                                    <p class="text-sm text-gray-500">{{ doc.description }}</p>
                                {% endif %}
                                <p class="text-xs text-gray-400">{{ doc.pages.count }} page{{ doc.pages.count|pluralize }}</p>
                            </div>
                            <div class="flex gap-2">
                                <a href="{% url 'library:document_detail' project_id=project.id document_id=doc.id %}"
                                   class="btn btn-sm btn-outline">
                                    Open
                                </a>
                                <button
                                    hx-get="{% url 'library:document_delete' project_id=project.id document_id=doc.id %}"
                                    hx-target="#modal-content"
                                    hx-swap="innerHTML"
                                    onclick="openModal('Delete Document')"
                                    class="btn btn-sm btn-accent">
                                    Delete
                                </button>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <p class="text-gray-500">No documents yet.
                    <a href="{% url 'library:document_create' project_id=project.id %}" class="link">
                        Create your first document
                    </a>.
                </p>
            {% endif %}
        {% endwith %}
    </div>

    {# ---- ENTITY TYPES ---- #}
    <div>
        <h2>Entity Types</h2>
        <div id="entity-list" class="space-y-4">
            {% for entity in project.entity_types.all %}
                {% include "partials/entitytype_list_partial.html" %}
            {% endfor %}
            <div id="entity-new"></div>
        </div>

        <button
                hx-get="{% url 'projects:add_entitytype' project.pk %}"
                hx-target="#entity-new"
                hx-swap="innerHTML"
                class="btn btn-primary mt-4"
        >
            + Add Entity Type
        </button>
    </div>

{% endblock %}